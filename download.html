<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luma ‚Äî Smart Accessibility Suite</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0b0f1a;
      --surface: #141a2e;
      --surface-hover: #1c2440;
      --accent: #00e676;
      --accent-dim: rgba(0, 230, 118, 0.12);
      --accent-glow: rgba(0, 230, 118, 0.25);
      --text: #e8eaf6;
      --text-secondary: #9fa8c7;
      --border: rgba(255, 255, 255, 0.06);
      --radius: 16px;
      --danger: #f44336;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* --- Nav --- */
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 100;
      background: rgba(11, 15, 26, 0.92);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 0 24px;
    }
    .nav-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 64px;
    }
    .nav-brand {
      font-size: 1.3rem;
      font-weight: 800;
      color: var(--accent);
      text-decoration: none;
      letter-spacing: -0.02em;
    }
    .nav-tabs {
      display: flex;
      gap: 4px;
      list-style: none;
    }
    .nav-tab {
      padding: 8px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      background: none;
      text-decoration: none;
    }
    .nav-tab:hover {
      color: var(--text);
      background: var(--surface);
    }
    .nav-tab.active {
      color: var(--accent);
      background: var(--accent-dim);
      border-color: rgba(0, 230, 118, 0.2);
    }

    /* --- Tab Content --- */
    .tab-content { display: none; padding-top: 80px; }
    .tab-content.active { display: block; }

    /* ==========================================
       TAB 1: IoT DASHBOARD
       ========================================== */
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .dashboard-header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 32px;
      background: var(--surface);
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }
    .dashboard-header h1 {
      font-size: 2.2em;
      margin-bottom: 8px;
      letter-spacing: -0.02em;
    }
    .dashboard-header p {
      font-size: 1rem;
      color: var(--text-secondary);
    }

    /* Emergency Alert */
    .emergency-alert {
      position: fixed;
      top: 80px;
      right: 20px;
      background: var(--danger);
      color: white;
      padding: 0;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(244, 67, 54, 0.5);
      z-index: 1000;
      animation: pulse 1s infinite;
      max-width: 400px;
      display: none;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    .alert-content {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 20px;
    }
    .alert-icon {
      font-size: 2.5em;
      animation: shake 0.5s infinite;
    }
    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      75% { transform: rotate(10deg); }
    }
    .alert-text h3 { margin: 0 0 5px 0; font-size: 1.2em; }
    .alert-text p { margin: 0; font-size: 0.9em; opacity: 0.9; }
    .alert-close {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 15px;
      margin-left: auto;
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .alert-close:hover { background: rgba(255, 255, 255, 0.3); }

    /* Config Section */
    .config-section {
      background: var(--surface);
      padding: 24px;
      border-radius: var(--radius);
      margin-bottom: 28px;
      border: 1px solid var(--border);
    }
    .config-section h2 {
      margin-bottom: 16px;
      font-size: 1.2em;
      font-weight: 600;
    }
    .config-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 15px;
      align-items: end;
    }
    .input-group {
      display: flex;
      flex-direction: column;
    }
    .input-group label {
      margin-bottom: 6px;
      font-size: 0.85em;
      color: var(--text-secondary);
    }
    .input-group input {
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      font-size: 0.95em;
    }
    .input-group input::placeholder { color: rgba(255, 255, 255, 0.3); }
    .input-group input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
    }

    .dash-btn {
      padding: 10px 24px;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: #0b0f1a;
      font-size: 0.95em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .dash-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px var(--accent-glow);
    }
    .dash-btn:disabled {
      background: #444;
      color: #888;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .status-msg {
      text-align: center;
      padding: 10px;
      margin-top: 15px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9em;
      display: none;
    }
    .status-msg.success { background: rgba(0, 230, 118, 0.15); color: var(--accent); }
    .status-msg.error { background: rgba(244, 67, 54, 0.15); color: var(--danger); }

    #apiConfig {
      margin-top: 20px;
      border-top: 1px solid var(--border);
      padding-top: 20px;
    }

    /* Sensor Cards */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    .card {
      background: var(--surface);
      padding: 24px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      transition: all 0.25s;
      position: relative;
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      border-color: rgba(0, 230, 118, 0.15);
    }
    .card-label {
      font-size: 0.8em;
      color: var(--text-secondary);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }
    .card-value {
      font-size: 2.4em;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .card-unit {
      font-size: 0.85em;
      color: var(--text-secondary);
    }
    .button-state {
      display: inline-block;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      margin-right: 10px;
      vertical-align: middle;
      box-shadow: 0 0 10px currentColor;
    }
    .button-pressed { background-color: var(--danger); color: var(--danger); }
    .button-not-pressed { background-color: var(--accent); color: var(--accent); }

    .location-card .card-value { font-size: 1em; }
    .location-card .dash-btn { margin-top: 10px; padding: 8px 15px; font-size: 0.9em; }

    /* Camera Card */
    .camera-card {
      grid-column: span 2;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .video-container {
      position: relative;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
      background: #000;
      aspect-ratio: 16/9;
    }
    #cameraPreview {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .camera-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .scan-btn {
      background: #2196F3;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 0.95em;
      transition: all 0.2s;
    }
    .scan-btn:hover { background: #1976D2; }
    .scan-btn:disabled { background: #444; color: #888; cursor: not-allowed; }
    .scan-btn.highlight {
      animation: pulse-blue 1s infinite;
      background: #00bcd4;
      box-shadow: 0 0 20px rgba(0, 188, 212, 0.5);
    }
    @keyframes pulse-blue {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 188, 212, 0.7); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(0, 188, 212, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 188, 212, 0); }
    }
    .ai-response {
      background: rgba(0, 0, 0, 0.3);
      padding: 16px;
      border-radius: 10px;
      font-style: italic;
      border-left: 4px solid #2196F3;
      min-height: 50px;
      font-size: 0.95em;
      color: var(--text-secondary);
    }

    /* Charts */
    .charts-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
      margin-top: 32px;
      padding-bottom: 60px;
    }
    .chart-container {
      background: var(--surface);
      padding: 24px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }
    .chart-title {
      font-size: 1.05em;
      margin-bottom: 16px;
      text-align: center;
      font-weight: 600;
    }
    canvas { max-height: 300px; }

    /* ==========================================
       TAB 2: EXTENSION DOWNLOAD
       ========================================== */
    .ext-container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px 24px;
    }

    /* Hero */
    .hero {
      text-align: center;
      padding: 60px 0 80px;
      position: relative;
    }
    .hero::before {
      content: '';
      position: absolute;
      top: -40%;
      left: 50%;
      transform: translateX(-50%);
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
      pointer-events: none;
    }
    .hero-content { position: relative; max-width: 720px; margin: 0 auto; }
    .hero-badge {
      display: inline-block;
      background: var(--accent-dim);
      color: var(--accent);
      padding: 6px 16px;
      border-radius: 100px;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      margin-bottom: 24px;
      border: 1px solid rgba(0, 230, 118, 0.2);
    }
    .hero h1 {
      font-size: clamp(2.2rem, 5vw, 3.4rem);
      font-weight: 800;
      line-height: 1.1;
      letter-spacing: -0.03em;
      margin-bottom: 20px;
    }
    .hero h1 span { color: var(--accent); }
    .hero p {
      font-size: 1.1rem;
      color: var(--text-secondary);
      max-width: 540px;
      margin: 0 auto 36px;
      line-height: 1.7;
    }
    .hero-actions { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 28px;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }
    .btn-primary {
      background: var(--accent);
      color: #0b0f1a;
      box-shadow: 0 4px 24px var(--accent-glow);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px var(--accent-glow);
    }
    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover {
      background: var(--surface-hover);
      transform: translateY(-1px);
    }

    /* Section Styling */
    .ext-section {
      padding: 80px 0;
    }
    .section-label {
      display: inline-block;
      background: var(--accent-dim);
      color: var(--accent);
      padding: 4px 14px;
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 16px;
    }
    .section-title {
      font-size: clamp(1.8rem, 3vw, 2.4rem);
      font-weight: 700;
      line-height: 1.2;
      letter-spacing: -0.02em;
      margin-bottom: 16px;
    }
    .section-subtitle {
      font-size: 1.05rem;
      color: var(--text-secondary);
      max-width: 560px;
      line-height: 1.7;
      margin-bottom: 48px;
    }

    /* Features Grid */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .feature-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px;
      transition: all 0.25s;
    }
    .feature-card:hover {
      background: var(--surface-hover);
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
    }
    .feature-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: var(--accent-dim);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      margin-bottom: 16px;
    }
    .feature-card h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; }
    .feature-card p { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; }

    /* Commands Grid */
    .commands-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    .command-group {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
    }
    .command-group h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 14px;
      color: var(--accent);
    }
    .command-group ul { list-style: none; }
    .command-group li {
      padding: 6px 0;
      font-size: 0.88rem;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }
    .command-group li:last-child { border-bottom: none; }
    .command-group li code {
      background: rgba(0, 230, 118, 0.08);
      color: var(--accent);
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 0.82rem;
      font-family: 'SF Mono', 'Fira Code', monospace;
    }

    /* Install Steps */
    .install-steps {
      counter-reset: step;
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 680px;
    }
    .install-step {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      transition: all 0.2s;
    }
    .install-step:hover { background: var(--surface-hover); }
    .step-number {
      counter-increment: step;
      flex-shrink: 0;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: var(--accent-dim);
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
    }
    .step-number::before { content: counter(step); }
    .step-content h3 { font-size: 1rem; font-weight: 600; margin-bottom: 4px; }
    .step-content p { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; }
    .step-content code {
      background: rgba(0, 230, 118, 0.08);
      color: var(--accent);
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 0.82rem;
      font-family: 'SF Mono', 'Fira Code', monospace;
    }

    /* FAQ */
    .faq-list { max-width: 680px; }
    .faq-item {
      border-bottom: 1px solid var(--border);
      padding: 20px 0;
    }
    .faq-item summary {
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      list-style: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .faq-item summary::-webkit-details-marker { display: none; }
    .faq-item summary::after {
      content: '+';
      font-size: 1.3rem;
      color: var(--accent);
      transition: transform 0.2s;
    }
    .faq-item[open] summary::after { transform: rotate(45deg); }
    .faq-item p {
      margin-top: 12px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.7;
    }

    /* Footer */
    footer {
      border-top: 1px solid var(--border);
      padding: 40px 24px;
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }
    footer a { color: var(--accent); text-decoration: none; }

    /* Responsive */
    @media (max-width: 768px) {
      .config-inputs { grid-template-columns: 1fr; }
      .charts-section { grid-template-columns: 1fr; }
      .camera-card { grid-column: span 1; }
      .dashboard-header h1 { font-size: 1.6em; }
      .emergency-alert { left: 20px; right: 20px; max-width: none; }
    }
    @media (max-width: 640px) {
      .nav-tabs { gap: 2px; }
      .nav-tab { padding: 8px 12px; font-size: 0.82rem; }
      .hero-actions { flex-direction: column; align-items: center; }
      .btn { width: 100%; justify-content: center; }
    }
  </style>
</head>
<body>

  <!-- Nav -->
  <nav>
    <div class="nav-inner">
      <a href="#" class="nav-brand" onclick="switchTab('dashboard'); return false;">Luma</a>
      <div class="nav-tabs">
        <button class="nav-tab active" id="tab-btn-dashboard" onclick="switchTab('dashboard')">Dashboard</button>
        <button class="nav-tab" id="tab-btn-extension" onclick="switchTab('extension')">Voice Extension</button>
      </div>
    </div>
  </nav>

  <!-- Emergency Alert (for dashboard) -->
  <div id="emergencyAlert" class="emergency-alert">
    <div class="alert-content">
      <div class="alert-icon">üö®</div>
      <div class="alert-text">
        <h3>EMERGENCY ALERT!</h3>
        <p>Button has been pressed! Check the location immediately.</p>
      </div>
      <button class="alert-close" onclick="dismissAlert()">Dismiss</button>
    </div>
  </div>

  <!-- ==========================================
       TAB 1: IoT DASHBOARD
       ========================================== -->
  <div id="tab-dashboard" class="tab-content active">
    <div class="dashboard-container">

      <div class="dashboard-header">
        <h1>üåê Luma IoT Dashboard</h1>
        <p>Real-time monitoring of sensors and actuators</p>
      </div>

      <div class="config-section">
        <h2>ThingSpeak Configuration</h2>
        <div class="config-inputs">
          <div class="input-group">
            <label>Channel ID:</label>
            <input type="text" id="channelId" placeholder="Enter your Channel ID">
          </div>
          <div class="input-group">
            <label>Read API Key (leave empty if public):</label>
            <input type="text" id="apiKey" placeholder="Enter Read API Key or leave empty">
          </div>
          <button class="dash-btn" onclick="startMonitoring()">Start Monitoring</button>
        </div>
        <div id="status" class="status-msg"></div>

        <div id="apiConfig" class="input-group">
          <label>Gemini API Key (for Environmental Scan):</label>
          <div style="display: flex; gap: 10px; margin-top: 6px;">
            <input type="password" id="geminiApiKey" placeholder="Enter Gemini API Key" style="flex: 1;">
            <button class="dash-btn" onclick="saveApiKey()">Save Key</button>
          </div>
        </div>
      </div>

      <div class="cards-grid">
        <div class="card">
          <div class="card-label">Distance</div>
          <div class="card-value" id="distance">--</div>
          <div class="card-unit">cm</div>
        </div>
        <div class="card">
          <div class="card-label">Rain Sensor</div>
          <div class="card-value" id="rain">--</div>
          <div class="card-unit">analog value</div>
        </div>
        <div class="card">
          <div class="card-label">Button State</div>
          <div class="card-value" id="button">
            <span class="button-state" id="buttonIndicator"></span>
            <span id="buttonText">--</span>
          </div>
        </div>
        <div class="card">
          <div class="card-label">Buzzer State</div>
          <div class="card-value" id="buzzer">
            <span class="button-state" id="buzzerIndicator"></span>
            <span id="buzzerText">--</span>
          </div>
        </div>
        <div class="card">
          <div class="card-label">Servo State</div>
          <div class="card-value" id="servo">
            <span class="button-state" id="servoIndicator"></span>
            <span id="servoText">--</span>
          </div>
        </div>
        <div class="card camera-card">
          <div class="card-label">Environmental Scan (AI)</div>
          <div class="video-container">
            <video id="cameraPreview" autoplay playsinline title="Camera Preview"></video>
          </div>
          <div class="camera-controls">
            <button class="dash-btn" id="startCameraBtn" onclick="initCamera()">Enable Camera</button>
            <button class="dash-btn" id="flipCameraBtn" onclick="flipCamera()" style="display: none; background: #9C27B0;">Flip Camera</button>
            <button class="scan-btn" id="scanBtn" onclick="captureAndScan()" disabled>üîç Scan Environment</button>
          </div>
          <div id="aiResponse" class="ai-response">Waiting for scan...</div>
        </div>
        <div class="card location-card">
          <div class="card-label">Location</div>
          <div class="card-value">
            <div id="latitude">Lat: --</div>
            <div id="longitude">Lon: --</div>
            <button class="dash-btn" id="viewMapBtn" onclick="openMap()" disabled>üìç View on Map</button>
          </div>
        </div>
      </div>

      <div class="charts-section">
        <div class="chart-container">
          <div class="chart-title">üìè Distance History</div>
          <canvas id="distanceChart"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">üåßÔ∏è Rain Sensor History</div>
          <canvas id="rainChart"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">üîò Button State History</div>
          <canvas id="buttonChart"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">üîî Buzzer State History</div>
          <canvas id="buzzerChart"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">‚öôÔ∏è Servo State History</div>
          <canvas id="servoChart"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">üåç Latitude History</div>
          <canvas id="latitudeChart"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">üåé Longitude History</div>
          <canvas id="longitudeChart"></canvas>
        </div>
      </div>

    </div>
  </div>

  <!-- ==========================================
       TAB 2: VOICE EXTENSION DOWNLOAD
       ========================================== -->
  <div id="tab-extension" class="tab-content">
    <div class="ext-container">

      <!-- Hero -->
      <section class="hero" aria-label="Introduction">
        <div class="hero-content">
          <div class="hero-badge">Open Source &middot; Free Forever</div>
          <h1>Browse the web<br>with your <span>voice</span></h1>
          <p>Luma Voice Extension gives blind and visually impaired users full control of any website through voice commands. No mouse, no keyboard ‚Äî just speak.</p>
          <div class="hero-actions">
            <a href="#ext-install" class="btn btn-primary" onclick="document.getElementById('ext-install').scrollIntoView({behavior:'smooth'}); return false;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              Download Extension
            </a>
            <a href="#ext-features" class="btn btn-secondary" onclick="document.getElementById('ext-features').scrollIntoView({behavior:'smooth'}); return false;">Learn More</a>
          </div>
        </div>
      </section>

      <!-- Features -->
      <section id="ext-features" class="ext-section" aria-label="Features">
        <div class="section-label">Features</div>
        <h2 class="section-title">Designed for accessibility, built for everyone</h2>
        <p class="section-subtitle">Every feature is crafted to make the web usable through voice alone ‚Äî no sighted assistance needed.</p>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">üé§</div>
            <h3>Wake Word Activation</h3>
            <p>Say "Hey Luma" to activate the assistant on any page. No need to click anything ‚Äî it's always listening for you.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üìñ</div>
            <h3>Page Reader</h3>
            <p>Reads page content, headings, and links aloud. Navigate between headings and links with simple voice commands.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üé¨</div>
            <h3>YouTube Control</h3>
            <p>Search videos, play, pause, skip, adjust volume, and go fullscreen ‚Äî all hands-free on YouTube.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üß≠</div>
            <h3>Page Navigation</h3>
            <p>Scroll, go back, jump to top or bottom, click elements by name, and open any website with a single command.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üí¨</div>
            <h3>Multi-Command Mode</h3>
            <p>Stays awake for 30 seconds after each command so you can chain multiple actions without repeating the wake word.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">‚å®Ô∏è</div>
            <h3>Keyboard Shortcut</h3>
            <p>Press Ctrl+Shift+S (or Cmd+Shift+S on Mac) to instantly toggle the assistant without saying the wake word.</p>
          </div>
        </div>
      </section>

      <!-- Commands -->
      <section class="ext-section" aria-label="Voice commands reference">
        <div class="section-label">Commands</div>
        <h2 class="section-title">Everything you can say</h2>
        <p class="section-subtitle">A complete reference of all voice commands. Just wake the assistant and speak naturally.</p>
        <div class="commands-grid">
          <div class="command-group">
            <h3>Page Reading</h3>
            <ul>
              <li><code>read page</code> ‚Äî Read main content aloud</li>
              <li><code>read headings</code> ‚Äî List all headings</li>
              <li><code>read links</code> ‚Äî List visible links</li>
              <li><code>read selection</code> ‚Äî Read highlighted text</li>
              <li><code>summarize</code> ‚Äî Get a page summary</li>
              <li><code>where am I</code> ‚Äî Current page and site info</li>
            </ul>
          </div>
          <div class="command-group">
            <h3>Navigation</h3>
            <ul>
              <li><code>next heading</code> / <code>previous heading</code></li>
              <li><code>next link</code> / <code>previous link</code></li>
              <li><code>click [text]</code> ‚Äî Click an element by its text</li>
              <li><code>scroll down</code> / <code>scroll up</code></li>
              <li><code>go to top</code> / <code>go to bottom</code></li>
              <li><code>go back</code> / <code>refresh</code></li>
            </ul>
          </div>
          <div class="command-group">
            <h3>YouTube &amp; Media</h3>
            <ul>
              <li><code>search for [topic]</code> ‚Äî YouTube search</li>
              <li><code>play first video</code> ‚Äî Play top result</li>
              <li><code>play</code> / <code>pause</code></li>
              <li><code>forward 30</code> / <code>backward 10</code></li>
              <li><code>volume up</code> / <code>volume down</code></li>
              <li><code>mute</code> / <code>fullscreen</code></li>
            </ul>
          </div>
          <div class="command-group">
            <h3>Utilities</h3>
            <ul>
              <li><code>open YouTube</code> / <code>open Google</code></li>
              <li><code>open [any website]</code></li>
              <li><code>what time is it</code> / <code>what is the date</code></li>
              <li><code>zoom in</code> / <code>zoom out</code> / <code>reset zoom</code></li>
              <li><code>stop</code> ‚Äî Interrupt speech</li>
              <li><code>go to sleep</code> ‚Äî Deactivate assistant</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Install -->
      <section id="ext-install" class="ext-section" aria-label="Installation instructions">
        <div class="section-label">Install</div>
        <h2 class="section-title">Get started in under a minute</h2>
        <p class="section-subtitle">Luma Voice Extension runs on Chrome, Edge, Brave, and any Chromium-based browser.</p>

        <a href="https://github.com/snehaa006/Voice-Assistant-/archive/refs/heads/main.zip" class="btn btn-primary" style="margin-bottom: 40px;" download>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Download ZIP from GitHub
        </a>

        <div class="install-steps">
          <div class="install-step">
            <div class="step-number" aria-hidden="true"></div>
            <div class="step-content">
              <h3>Download the extension</h3>
              <p>Click the download button above. You'll get a <code>.zip</code> file containing all extension files.</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number" aria-hidden="true"></div>
            <div class="step-content">
              <h3>Unzip the folder</h3>
              <p>Extract the ZIP file to a permanent location on your computer (e.g., your Documents folder). Don't delete this folder ‚Äî Chrome needs it.</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number" aria-hidden="true"></div>
            <div class="step-content">
              <h3>Open the extensions page</h3>
              <p>Open Chrome and go to <code>chrome://extensions</code> in the address bar. Or go to Menu &rarr; Extensions &rarr; Manage Extensions.</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number" aria-hidden="true"></div>
            <div class="step-content">
              <h3>Enable Developer Mode</h3>
              <p>In the top-right corner of the extensions page, toggle on <strong>Developer mode</strong>.</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number" aria-hidden="true"></div>
            <div class="step-content">
              <h3>Load the extension</h3>
              <p>Click <strong>"Load unpacked"</strong> in the top-left, then select the unzipped folder. Luma will appear in your extensions list.</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number" aria-hidden="true"></div>
            <div class="step-content">
              <h3>Allow microphone access</h3>
              <p>Visit any website and allow microphone access when prompted. Say <strong>"Hey Luma"</strong> ‚Äî you're ready to go.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- FAQ -->
      <section class="ext-section" aria-label="Frequently asked questions">
        <div class="section-label">FAQ</div>
        <h2 class="section-title">Frequently asked questions</h2>
        <p class="section-subtitle">Quick answers to common questions about the Luma Voice Extension.</p>
        <div class="faq-list">
          <details class="faq-item">
            <summary>Which browsers are supported?</summary>
            <p>The voice extension works on Chrome, Microsoft Edge, Brave, Opera, and any Chromium-based browser that supports the Web Speech API. Firefox and Safari are not yet supported.</p>
          </details>
          <details class="faq-item">
            <summary>Is it free?</summary>
            <p>Yes, completely free and open source. No accounts, no subscriptions, no data collection.</p>
          </details>
          <details class="faq-item">
            <summary>Does it send my voice data anywhere?</summary>
            <p>Luma uses your browser's built-in speech recognition (Web Speech API). Voice processing is handled by your browser ‚Äî the extension itself does not transmit or store any audio.</p>
          </details>
          <details class="faq-item">
            <summary>Can I use it without saying the wake word?</summary>
            <p>Yes. Press <strong>Ctrl+Shift+S</strong> (or <strong>Cmd+Shift+S</strong> on Mac) to activate the assistant instantly.</p>
          </details>
          <details class="faq-item">
            <summary>Why does it ask for microphone permission on every site?</summary>
            <p>Chrome requires microphone permission per-site for security. You can allow it permanently for trusted sites in Chrome's site settings.</p>
          </details>
          <details class="faq-item">
            <summary>The assistant isn't hearing me. What should I do?</summary>
            <p>Make sure microphone access is allowed (check the lock icon in the address bar). Try refreshing the page. If using Bluetooth, ensure it's set as the default input device.</p>
          </details>
        </div>
      </section>

    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>Luma &middot; Smart Accessibility Suite &middot; Open source on <a href="https://github.com/snehaa006/Voice-Assistant-" target="_blank" rel="noopener">GitHub</a></p>
    <p style="margin-top: 8px;">Built to make the world accessible for everyone.</p>
  </footer>

  <!-- ==========================================
       SCRIPTS
       ========================================== -->
  <script>
    // --- Tab Switching ---
    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
      document.getElementById('tab-' + tab).classList.add('active');
      document.getElementById('tab-btn-' + tab).classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // --- Dashboard Logic (from index.html, unchanged functionality) ---
    let channelId = '';
    let apiKeyVal = '';
    let updateInterval = null;
    let isMonitoring = false;
    const maxDataPoints = 50;
    const chartData = {
      distance: [], rain: [], button: [], buzzer: [], servo: [],
      latitude: [], longitude: [], labels: []
    };
    let currentLat = null;
    let currentLon = null;
    let lastButtonState = null;
    let geminiApiKey = localStorage.getItem('geminiApiKey') || '';
    let currentFacingMode = 'environment';
    let currentStream = null;

    if (geminiApiKey) {
      document.getElementById('geminiApiKey').value = geminiApiKey;
    }

    function saveApiKey() {
      const key = document.getElementById('geminiApiKey').value.trim();
      if (key) {
        localStorage.setItem('geminiApiKey', key);
        geminiApiKey = key;
        alert('API Key saved locally!');
      }
    }

    // Camera
    async function initCamera() {
      try {
        if (currentStream) {
          currentStream.getTracks().forEach(track => track.stop());
        }
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: currentFacingMode }
        });
        currentStream = stream;
        document.getElementById('cameraPreview').srcObject = stream;
        document.getElementById('scanBtn').disabled = false;
        document.getElementById('startCameraBtn').style.display = 'none';
        document.getElementById('flipCameraBtn').style.display = 'inline-block';
        dashSpeak(`Camera enabled using ${currentFacingMode === 'environment' ? 'back' : 'front'} lens.`);
      } catch (err) {
        console.error("Error accessing camera:", err);
        alert("Could not access camera. Please ensure you're using HTTPS and have granted permissions.");
      }
    }

    async function flipCamera() {
      currentFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
      await initCamera();
    }

    function dashSpeak(text) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        window.speechSynthesis.speak(utterance);
      }
    }

    async function captureAndScan() {
      if (!geminiApiKey) {
        alert("Please enter a Gemini API Key in the configuration section.");
        return;
      }
      const video = document.getElementById('cameraPreview');
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);
      const base64Image = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];
      const aiResponseEl = document.getElementById('aiResponse');
      aiResponseEl.textContent = "Analyzing environment...";
      dashSpeak("Scanning environment. Please wait.");

      try {
        const modelsToTry = [
          'gemini-2.0-flash', 'gemini-2.0-flash-001', 'gemini-flash-latest',
          'gemini-2.5-flash', 'gemini-1.5-flash', 'gemini-1.5-flash-latest'
        ];
        let success = false;
        let lastError = "";

        for (const modelName of modelsToTry) {
          try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${geminiApiKey}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                contents: [{ parts: [
                  { text: "Role: You are the 'Virtual Eyes' for LUMA, an advanced smart stick assistant. \n\nTask: Provide a highly descriptive situational awareness report of the path ahead. \n\nStructure your response: \n1. Direct Path: State if 'Clear' or 'Obstructed' (name the obstacle and its clock-face position).\n2. Surface: Identify the ground type and hazards like puddles or steps.\n3. Landmarks/Barriers: Note entrances with stairs but no ramps.\n\nKeep response under 50 words. Ensure the sentence is COMPLETE and helps the user walk safely. Do not stop mid-sentence." },
                  { inlineData: { mimeType: "image/jpeg", data: base64Image } }
                ]}],
                generationConfig: { temperature: 0.1, maxOutputTokens: 1024 }
              })
            });
            const data = await response.json();
            if (response.ok && data.candidates && data.candidates.length > 0) {
              const description = data.candidates[0].content.parts.map(p => p.text).join(' ').replace(/\*\*/g, '').trim();
              if (description) {
                aiResponseEl.textContent = description;
                dashSpeak(description);
                success = true;
                break;
              }
            }
            lastError = data.error ? data.error.message : "Model failed";
          } catch (innerErr) {
            lastError = innerErr.message;
          }
        }
        if (!success) throw new Error(lastError || "Could not find a supported Gemini model.");
      } catch (err) {
        let displayError = "Error analyzing image.";
        if (err.message.includes("API key")) {
          displayError = "Invalid API Key. Please get a fresh key from Google AI Studio.";
          dashSpeak("Your API key seems to be invalid.");
        } else if (err.message.includes("quota") || err.message.includes("429")) {
          displayError = "Quota Exceeded. Please wait 60 seconds.";
          dashSpeak("The AI is busy, please wait a minute.");
        } else {
          displayError = err.message;
        }
        aiResponseEl.textContent = displayError;
      }
    }

    function dismissAlert() {
      document.getElementById('emergencyAlert').style.display = 'none';
    }

    function openMap() {
      if (currentLat && currentLon) {
        window.open(`https://www.google.com/maps?q=${currentLat},${currentLon}`, '_blank');
      }
    }

    function showStatus(message, isError) {
      const statusEl = document.getElementById('status');
      statusEl.textContent = message;
      statusEl.className = 'status-msg ' + (isError ? 'error' : 'success');
      statusEl.style.display = 'block';
    }

    function startMonitoring() {
      channelId = document.getElementById('channelId').value.trim();
      apiKeyVal = document.getElementById('apiKey').value.trim();
      if (!channelId) { showStatus('Please enter a Channel ID', true); return; }
      if (isMonitoring) clearInterval(updateInterval);
      showStatus('Starting monitoring...', false);
      isMonitoring = true;
      fetchData();
      updateInterval = setInterval(fetchData, 5000);
    }

    async function fetchData() {
      try {
        let url = `https://api.thingspeak.com/channels/${channelId}/feeds.json?results=20`;
        if (apiKeyVal) url += `&api_key=${apiKeyVal}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        if (data.feeds && data.feeds.length > 0) {
          updateDisplay(data.feeds[data.feeds.length - 1]);
          updateChartsWithMultipleFeeds(data.feeds);
          showStatus('Data updated successfully', false);
        } else {
          showStatus('No data available yet', true);
        }
      } catch (error) {
        showStatus('Error: ' + error.message, true);
      }
    }

    function updateDisplay(feed) {
      const distance = feed.field1 ? parseFloat(feed.field1).toFixed(1) : '--';
      document.getElementById('distance').textContent = distance;
      const scanBtn = document.getElementById('scanBtn');
      if (distance !== '--' && parseFloat(distance) < 20) {
        if (!scanBtn.classList.contains('highlight')) {
          scanBtn.classList.add('highlight');
          dashSpeak("Object detected nearby. Consider scanning the environment.");
        }
      } else {
        scanBtn.classList.remove('highlight');
      }

      document.getElementById('rain').textContent = feed.field2 ? parseInt(feed.field2) : '--';

      const button = feed.field3;
      const buttonIndicator = document.getElementById('buttonIndicator');
      const buttonText = document.getElementById('buttonText');
      if (button !== null && button !== undefined) {
        const state = parseInt(button);
        if (lastButtonState !== null && lastButtonState === 1 && state === 0) {
          document.getElementById('emergencyAlert').style.display = 'block';
        }
        lastButtonState = state;
        buttonText.textContent = state === 0 ? 'Pressed' : 'Not Pressed';
        buttonIndicator.className = 'button-state ' + (state === 0 ? 'button-pressed' : 'button-not-pressed');
      } else {
        buttonText.textContent = '--';
        buttonIndicator.className = 'button-state';
      }

      const buzzer = feed.field6;
      const buzzerIndicator = document.getElementById('buzzerIndicator');
      const buzzerText = document.getElementById('buzzerText');
      if (buzzer !== null && buzzer !== undefined) {
        const state = parseInt(buzzer);
        buzzerText.textContent = state === 1 ? 'ON' : 'OFF';
        buzzerIndicator.className = 'button-state ' + (state === 1 ? 'button-pressed' : 'button-not-pressed');
      } else {
        buzzerText.textContent = '--';
        buzzerIndicator.className = 'button-state';
      }

      const servo = feed.field7;
      const servoIndicator = document.getElementById('servoIndicator');
      const servoText = document.getElementById('servoText');
      if (servo !== null && servo !== undefined) {
        const state = parseInt(servo);
        servoText.textContent = state === 1 ? 'ON' : 'OFF';
        servoIndicator.className = 'button-state ' + (state === 1 ? 'button-pressed' : 'button-not-pressed');
      } else {
        servoText.textContent = '--';
        servoIndicator.className = 'button-state';
      }

      document.getElementById('latitude').textContent = `Lat: ${feed.field4 ? parseFloat(feed.field4).toFixed(7) : '--'}`;
      document.getElementById('longitude').textContent = `Lon: ${feed.field5 ? parseFloat(feed.field5).toFixed(7) : '--'}`;
      if (feed.field4 && feed.field5) {
        currentLat = parseFloat(feed.field4);
        currentLon = parseFloat(feed.field5);
        document.getElementById('viewMapBtn').disabled = false;
      }
    }

    function updateChartsWithMultipleFeeds(feeds) {
      chartData.distance.length = 0; chartData.rain.length = 0;
      chartData.button.length = 0; chartData.buzzer.length = 0;
      chartData.servo.length = 0; chartData.latitude.length = 0;
      chartData.longitude.length = 0; chartData.labels.length = 0;

      feeds.forEach(feed => {
        const timeStr = new Date(feed.created_at).toLocaleTimeString();
        chartData.labels.push(timeStr);
        chartData.distance.push(feed.field1 ? parseFloat(feed.field1) : null);
        chartData.rain.push(feed.field2 ? parseInt(feed.field2) : null);
        chartData.button.push(feed.field3 != null ? parseInt(feed.field3) : null);
        chartData.buzzer.push(feed.field6 != null ? parseInt(feed.field6) : null);
        chartData.servo.push(feed.field7 != null ? parseInt(feed.field7) : null);
        chartData.latitude.push(feed.field4 ? parseFloat(feed.field4) : null);
        chartData.longitude.push(feed.field5 ? parseFloat(feed.field5) : null);
      });

      if (chartData.distance.length > maxDataPoints) {
        const excess = chartData.distance.length - maxDataPoints;
        Object.values(chartData).forEach(arr => arr.splice(0, excess));
      }

      [distanceChart, rainChart, buttonChart, buzzerChart, servoChart, latitudeChart, longitudeChart].forEach(c => c.update());
    }

    // --- Charts ---
    const chartConfig = {
      type: 'line',
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, ticks: { color: '#9fa8c7' }, grid: { color: 'rgba(255,255,255,0.05)' } },
          x: { ticks: { color: '#9fa8c7', maxRotation: 45, minRotation: 45 }, grid: { color: 'rgba(255,255,255,0.05)' } }
        }
      }
    };

    const steppedConfig = (color, labelCb) => ({
      ...chartConfig,
      options: { ...chartConfig.options, scales: { ...chartConfig.options.scales,
        y: { ...chartConfig.options.scales.y, max: 1.5, ticks: { color: '#9fa8c7', callback: labelCb } }
      }}
    });

    const coordConfig = (color) => ({
      ...chartConfig,
      options: { ...chartConfig.options, scales: { ...chartConfig.options.scales,
        y: { ...chartConfig.options.scales.y, beginAtZero: false, ticks: { color: '#9fa8c7', callback: v => v.toFixed(6) } }
      }}
    });

    function makeDataset(label, data, color, opts = {}) {
      return { label, data, borderColor: color, backgroundColor: color + '1a', tension: 0.4, fill: true, ...opts };
    }

    const distanceChart = new Chart(document.getElementById('distanceChart'), { ...chartConfig, data: { labels: chartData.labels, datasets: [makeDataset('Distance (cm)', chartData.distance, '#4CAF50')] } });
    const rainChart = new Chart(document.getElementById('rainChart'), { ...chartConfig, data: { labels: chartData.labels, datasets: [makeDataset('Rain Value', chartData.rain, '#2196F3')] } });

    const btnLabelCb = v => v === 0 ? 'Pressed' : v === 1 ? 'Not Pressed' : '';
    const onOffCb = v => v === 0 ? 'OFF' : v === 1 ? 'ON' : '';

    const buttonChart = new Chart(document.getElementById('buttonChart'), { ...steppedConfig('#FF9800', btnLabelCb), data: { labels: chartData.labels, datasets: [makeDataset('Button State', chartData.button, '#FF9800', { stepped: true })] } });
    const buzzerChart = new Chart(document.getElementById('buzzerChart'), { ...steppedConfig('#E91E63', onOffCb), data: { labels: chartData.labels, datasets: [makeDataset('Buzzer State', chartData.buzzer, '#E91E63', { stepped: true })] } });
    const servoChart = new Chart(document.getElementById('servoChart'), { ...steppedConfig('#9C27B0', onOffCb), data: { labels: chartData.labels, datasets: [makeDataset('Servo State', chartData.servo, '#9C27B0', { stepped: true })] } });

    const pointOpts = { pointRadius: 4, pointHoverRadius: 6, pointBorderColor: '#fff', pointBorderWidth: 2 };
    const latitudeChart = new Chart(document.getElementById('latitudeChart'), { ...coordConfig('#00BCD4'), data: { labels: chartData.labels, datasets: [makeDataset('Latitude', chartData.latitude, '#00BCD4', { ...pointOpts, pointBackgroundColor: '#00BCD4' })] } });
    const longitudeChart = new Chart(document.getElementById('longitudeChart'), { ...coordConfig('#FF5722'), data: { labels: chartData.labels, datasets: [makeDataset('Longitude', chartData.longitude, '#FF5722', { ...pointOpts, pointBackgroundColor: '#FF5722' })] } });
  </script>

</body>
</html>
